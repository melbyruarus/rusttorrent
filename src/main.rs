extern crate rustc_serialize as serialize;
extern crate byteorder;
extern crate rusttorrent;

use std::net::TcpStream;
use std::str::FromStr;
use rusttorrent::messages::*;
use rusttorrent::support::*;
use std::thread;

// MetaInfo
// todo: move this to own home
use self::serialize::hex::FromHex;

struct Info {
	piece_len: u32,
	pieces: Vec<[u8; 20]>,
	private: bool,
	name: String,
	length: u32
}

struct MetaInfo {
	info: Info,
	announce: String,
	announce_list: Vec<String>,
	creation_date: u32,
	comment: String,
	created_by: String,
	encoding: String
}

fn main() {
	let piece_hashes_string = "825CE9C0F3A3944444CAFE1DB4F8EEFBB7346A7B1B891168A7C212B066F3122217387122698F8B0C4887CE2796DD5531B81AEACB5632D55D0689AF4768D430F77D4D59F591DB0B576E88C683D086EC89AAC46150EB9E3011C5684B2890665CBF18ECACE197D41A679304D37CA7976091160A8E8EF7B4320F5516B38ADFEA3AB80673D8F3703FD8E8B1DADA1478A614FA6A2AD5D05DBF7F8B75E747D79EB52941B0E0F2CD29736A7018BD11F5C45CD9B6FF934FAE89F5ADA2FE17C1C0EF6845B3D4D21570E1DE95FAD0CA9D87199B2B147BF44CD1CB31DD03197CE9DFEB1C3278B97973CC286E6A3AC5F1824BFD89F539380907931EA7FAA81C78AB260760DA77C5235DBA17359E48E82D705A7697DAA794566F1B598EA0CD2B44EF0B3A436FDC06CE5CC359EB445DBBD11238A3FCAEA9C712D8CF062D1457955D94E250724B7DDE39671ED63F709BE3CEB975A0425FC85B796C248E48DD07FA43C1AA1706FB319248EC4084227D6458A37D77F66EDDEA4735A4C5D28E9F1D7D52381366BDA4F7D0AA0545FDA1E23FCBC0A56A059D8672E2FBFD6640101891F17F850ABA647695474C204C1442114555972FDE9BF304A31207C43DC58734B8483CAE83C37E39E98D266D89967AFBF809A30DF86E7BBF4243466FD2F92E67D3823F9E3F3C999703B0A2935340A2FD158A170EE5FD2FEE85D2B98F7A7C72D0130C4E2EEE5544D69577F056C856B7240149ACFABE4C33B446AB9E273BFA5069727F7E006C969D9FEE5A3A40A088E9F24582802A31837BD10CEDD50A6C83D1CD2469FFB930100905E3354269555D39F9D64DA131F9B1928C286128DD501B815A445561C4AE27E2BCE9766FF00092E8EBF0FB725B79EE5AE50B9BA199AD1316CE8F9CA8C8691B0A5885A40ECEC027FF69827E980AF4A74DFFE30C3EF6B48C6ECCDBAC4348672E00EA1AF0EE81B53C87A72B3E82B6BC926C7FFDD98A4F7541F7197CA5A2CB43A60AFCC18256BAF9106A50F22F467442E6EB5D9EF56D86A34B8EBA245918B128FB5B92EFBAC76C40EBB31E8E6375AEC7A5D970F63EFE1BE6FCF18DE9AEA05B354A69D8440A6ECBF33EE9CD5EBFDF8D47C0794C7B171E3164C0475A1676377FBB914108F6B53E84A9DCB8AE5F436B9305C2445936B27D3F718C4D77C987362F451DCEAEF025E6D402F9BC17D2FC8A825071AF4AEC04D24AA7830732CC4409B1AA038182BA4010BCEF02A186497E841DF83606F3759E664C5F27B3B5B33CE050221ADB3ED39D38A352F06E6D1D40BD79DE2685FEC63A6E8BE7DFE0617C930F90BA68E9A47E90F65A9CC9DFF82A6BAEBA22A6A9FB8D9C4ABFDB2B8ED62B418BFBE46665BC9BDFE7548EC0005E5BE8D01FD82592C3745232810B1B6D479B4AFAEE18A886001AD9CE3B7B54327F99137CB454F3AD40B0394D7CB72FD555563134AF226A0B4CB795221A064861238F021E82844BE2DAE4DF02521AC3106FDCF1FADD5AE8F891B625EDD729F784503DE12BC8F99D2D7C8137A20143097127A747E5611AEBDF0C4844831ECB02C017FF17085251165696DB094BE09D192BB26EF9114764B6174869B3EA779A5E184B9E920D65352926D5C0547950B58903226C825DCA1C7A0457766D061E608B97B1988C9ADCB9265837CAAD228763AFE0B26B0794E0FC80637D40CD707B5269E4E18A26BC51B728B3B4D56A012F7EA54E9AF6FC817D341943967AAAE75694121BD81B7979EDBE3A00CA04E26AA34CBCE141C2A57FB83E7626900F4274E3BBAED5F038DDB99670E1840959E4396639E6EA35F67AB1802937CA3AA8F8CC3EDAF84B5419A8083701B5B79ED37C7CA9BCBE319B90F66D39F867692543A6325AE248C08D3D4C4027928991DD77994ACBB422F37BEE993E958666C7D03319423E3CC819B8356D785C680577769FE8BA473819567F550120EEEF9CC038CCBB9219F9B3BAF37B18A782BE41EF51B7E2651880218C00B862C638DEEB7B1BC57DA580E921760B34C58D5DC3F0A12508E4C2A4BF68A2F54BDA325AF81D1480BBAC1BA7BC04BC89B141A1E4BF0BABCF1E44CC075C83F697D88020F3D6B170CDFAD3166A7A55522C6FCC3E87874CC76F5EAF0AC1E3F8FF0D9048A3A3F4F13F0D0C26AAB02E97B4D2FF824B1B94D5165F699E226BC5787FF07C1F7D941303F06CADFA7D541F1D06DF0D925DE213D8DAAC2A25FCFA0F05315E9826261354F7F88A588E283A9A03D422BEC527555EE24242A4388480AE2D6C604D777F87D080CEBDAB3A3B546616CADEDCDC804809C097E695372BB5DC8FE2C48ADF4F1982E966AEC583F60607A3F4DEBCDED94898F77045E4B1A1C07A841717FC61549C58591BBA71495E8F32048C1CCB910050460A7E56F7AE6FA124CAD921E4A1FFB2E5E5167DC2D2E59934D9D97881450B0BBDD86C134FA2011A4218B17EAB3F5FFED7A48E5A81B9CBCC3EFAFA525FA342B070D549FDEDCD03ED9AD8E188B7872D6AAB5E7AFAC5215F6FB69A2EAE48968C0D86E2CA4AF2D7AB44C6756EE996ABB9AE96FFBD4DF329464E1423F01E90BE9B979F49E241C8C57F7DAF372AD2C6C3756CE1696135006459E9374F564A9C34D6B63320CBE3784C36350EB3FE2222D2A6C92D6E903141BB7CCC0EA2495FB5D8BA9AF9214E20FD1921A440032C8CCD3C005F50D5C30AC80BBF08DB57D18D81AE76595945C2F0A6ABB14321C810BE2D6C00C1CC044677F07EA1264E620EBB4A95C087371DB2124345307B7128CE6A2FEEAA18DCA49E79F3E096F959C00576623A46BEC361241A257CB8EFDC545D723DC938E5230090071EBC752D8541817072DC63F87A932C892F679D27D50B58869136C9E1743F4382C06A3B22E431390A5B2AEE06741B18F5D851DAD410D2F10D71BC7834C171795AC6E605DD65AAFA7542EB9E6A75FB9540D19DC5ACC501F5FFC9680EDEBACCCA27B13544AE78A8C5D9AA84C2432AFA3F81F751E251524C603D56F6373DD27F52ED8AAEEE04A35D335A54B1D074EA38278A6AF27AE80AD28F66B0629EB49BEE7A514204502D2C12BD3ABC6FAF3672208CE69765DF8986397FCDD4AE50261A07D1A0368B8D3C853529F6BC436A47C1AB0FE739255261D8285E7F81C8A1795E4FC4DB944D53D16A36AF18AA414325F618ABB3C6AFB103C0A79663AB024C9D0ED05504F94A2580E288682C4EBBB4CA2783E8ECB91A14A0EF59926306AF306BCD124760CD953CE562AE40CAE3702C0D3BCA0E2772228BA6BC8468418D2626BD8E6D8FF43BEB87125445E337E5CEBD9E6B9313A637623BE1BD6F18A13CB2C1AED1C46B5C54FE72AB90092E244CE820AE15027BA346DEA3C0476187BC3ABA7EB79D15D3CE077F23F72CDEE68F353C627C183060A9B91F825FD1ED0018536D7F780155E17F3F480B787CDBF1A68E3D490B34CB6BA421EF45558675AA4CB410E12E5CD9DF7A43C3738DA70DAAF3B80F4367EAB7AF9CB9BBA2831FEB854AA4E0795C64F66B1C57321988EE46209485C96D21FB19ED15BEE3DE1F9CA29E81DB4D487FDBBDBBDECFD20C3EDB3BE2C0A6F5D600723338E2533DB5278AE0C950E52055BF33B25C24E8456D053FE0399BA2F73CC2C2245CC935CDEEAB49D43728AE296582C87C4D19C2BA9F4EAAC3327137DA3947A65B4669B9DB93F06B3DB86715BC3CB3DD3D720473FE124B1C4CE57818A2AB75508B8FF704771AD6B2AF092EAB35BED13FA655E9CA4E5CF1E7C826EF02FFE75A90039824D5B008EBC488F298671E1DEF1AE2A3F949627099C2042C315365580F22C95B9DA1099B18BD4B137FD5D5D9EADC85914347CFCC148FE8A82B99272B6D53F91C5585E532D74F646C0A178528B2E2C5ECAE76D43B05A248EA032122442E143F3C617641FBFEF889A6E659EFC1DEA71B0669095EDE2F7E630309F01B871B7EC9878335B464849682BFFE7ABB9C9BE387F623686E62F3A0AD776AF210456F9FC7CFA1640F07BAD5641C37B844D26BEED5BA636F7390D98252E628A37C1C7CC79981952888F0D1991F1F2AB4C78245A9A73CDE1CE93E1569D589F1EC5C5689A1620AF553BE66F939BD71A232034E56864D702AB0EEA918DBA7D6A6337B2590F68AB1D574A2864C2D717627B23885B420F6C6B79EE4BF50831F01874D5DC8C143CF957436BDBC8C3DF9B96397C50E55E325CF4BEEA44C2C7C132F9429237472DE9264C7332F4E43BCC8079BD2199725E1DAC63AFD61FB7193A1603084A77C3C712FCFA3302BF36D93D37B8D794EA0BB6F45658ECDE175FD1C6150192BE57C44839F48F06DC697843E633D121968C24CABD3AFAD957783AA2877EDBF9E0B37FDE648ABE05785084D249D4BD791B93851A375FE5D135A32C89E343FFB88EB7D1B66BB705A37EB4F2F423B712F728118B9E82DFF55785A80CE1A0281520E673118F06853A6B3A81A35C595CBF6CE3822D5016D2A9EA8116BB81060FFAE032F76FC70AA442BA6354E26FEC6BCA107B10976210E4C4A1C58070406D87FAF83DF5A273F130A29C1C708B869BC7CB822476FB1D66E7ADB31333EEE8F9E3AA9446E495BDE2A13097F9E0F8CF9707BFA3C2700CB4F01E4A3410FE3EA94092104EB7B3A45F6E11154167DAB6464BFA4B97241BFE3A4D636F487C9665DB18915ABCABFE0738437499BEA50C2C5F47EC8F948F92558558A9468EA53D7D28358B9F97D2E694CE01288CE395146F2C54DCA48E4F9E17A4F1150F1DE875AA4EAB02A9CB525F5DF4036F6690586EAB16961EBBB2A19C5BA123ED1E06D78E37C500A10A2D5403A3DB3028890F68B259E57FCBB74DACA870E123FD47E7EEDC5D8BD5D2C4CFC570DC6ABD9353EB6152114C3A66FAFC8F6E6873EBE95DAACEA2F0784493DB991BAF81777E4E68BA01A73FFCE175328AD337D35FCABECFC19E98CB46A8C22C3EA11CA4D3A14313B5C92127736F10B7DB53EA460938A7542730711E3AF40BC888A8533B092665B4288B3F6BCF6FA372F2A7CDF4EE2E505439FD178BAD844F6D216C717AED0EB942A69CAA60A1186EECC0BF6DF70639B595C87CE7DB1B9F5F87CFAE0045A1742355C5919DC1EB8E57E351DE3ACDD40A2182D286453E3E062DC4C3480382B233B0DB180F385E3BFB00D517C03243EF82AC5F90E9DD1A3509857BC8ED891448A30742731EA2220FF29249D01CECB4AB89B4365521B11221CF96F98CB916B3D21E6BC748A3BDEFA4D91940C84E52DB3722D1AC6A33750D4704FFD7A895C9CFCE38878E684899BFBC0C1E71005D367A14BCBF76616C4E08F9CC1D04D80C78E302C1FFFDD3A97E7547BC24F579E382D6DA0BAC8A4018F13B96BDC1FB8FFB4417948EE890CEBEE3B41F379ACE39EC37C6AE52879AA9CCBD6E4260611DFB1767D31589636717801256662D47F28A82339241BC13DEF4BE2CAF42D97C76672A8822FDD6F5925AEBE9E10177F7956FAD4D7E08C42B007589CB7735CCAFC3D8C88B844A1F2BA9FEAC7CF0E02B0E61F3AA249889BAEB19AA13F160359601CCF883423C7542DDEAEC88058E67938190EFB74D16033C7759AB4304B099606045DB13EE1D6ADBC7C1544D20C80360F97E755532ECF256E557AA41D94C4FD525C1C726E1FCBF05ED3C1DEAD0C588D8AD629B0DE9FCC822C204CF303967D071FF767E4739FCA760B8D525D4CE4D6F13B24A474C1681AAEB8618B4DFCF31ED649871FA6CFE1752B803184184E5ACBE9B4ED2E87788A3D942CB27DB905A12D03925C6E4A98A406598E988B8EA751C2D00B76B7FB0A7E6AEB3BED8CC8B95C68410FE5689130A4673792979EAAD16C6A2F635125F2F6107CB783AB979954FD600BBE81000B2F19C75F26B5B6984FD7AF0D74528F39161F4BC7910CCA161B1D334B1C0521FD6FCF8BA24D7FCFCB86AF228F005F87B0A90963219F0E280E671585EC2B517CD665FFD8DF1C41745CA0C032D54B2E71D4B922B0FA688AD5310F6C35278AA8F9F4FF4E70093345E0DB9246D74A75B03A78C0B87E0DB6BD086972365F390A13B0EC1BA4387776B6080EF8DEA28FC8CA64161B46A31C454E2732E11437F5C383231A8DCB9ACA65A6FDECE4EA0EA3D49364E7A164CCC151012B8AC8653BFB453AE1AD686379D7B469AC9A3888E6EC85873E583CED5B89EBB8C22C5C8D2CD8677F9C665D58B17B44504DD08F8E91F5BE831D1EF9AEA45D9EA177AB09324BFB6E9495719AE12B7CF543B956713D93D45D53710B108ED20373A45E0F9A441A85E544FDFDFCEB559938456FB9DC55C5BBCFB9764769E933CEF65917626E318A9BF17F55F78CDA17DDE7C3F9EE76792F67046FBDB43139885E362073661BEC34EBE3F751BCFE977C9E96375639650E95F1ACCA7680ED82E1FA6E387E92FD9DCAADE3D9F9CF4F18218CD07F1B2EDCFD86C059FE3D6B9E9D44BFEDDDFA935BE92CC2B7E841765AE1C1400079B82BF3BCD4A16BC0074FAE241498FE8FC3115B574CAB769D745C4089D41F336648094ACF66B41CCE21A9723BDA0567E60D2A255E03A3E9772115E4233F8CBD15B8C13676C276DE589D002C2242C4E1E85BAC3F3A25A137BAB821612A89F60271791B115DFCDD64FDF8558EDD41EA11CAAB21032EC089540F060ECA12179E394C61FF7465B1599A108ADD926252F529167F85A45CEEC5974AAC10BB00305C2CAE4ECAB172D562F170B2317F08EABFA5F464CDC0880928D4BCF65450D5010BA6A7C7389DAEBA59738AFDF1484CECDECBF5775988A8013954FDB6429E1EF28A65847177150E256F7E5436206CC99019A9A74441A71D1C48090039558FB3BD5CD6D804EBCE8B71069D943FA99E1AFD785D8A0331A3F165808E5948C13EEBC91D0A4F1DB39F210755A3A633DD5311BCAB1D12019B0BE1F5E7D6A8132B429EC89B84AAABD4F0E0EAA2E280800E8A2B6BE907E032095906AC3A5A04CEC787C9B041AADA0C062109252855225AA03F87F104234749CA2072882A09AE9777DD11DE54A2251601E8EC282DCB6DE11CECC6F0E3122A2381E819FE9D349D4977A2DDD73B5429A6D6612F01CAFAE44F3557294FDA22776A4BCEB6ED6F71C4A46F6F14A2CFFEBE4A316C4A50DFEE6CE491FC2DAD6D3B84D37F3129B226AECECCCACA473E9B906E4594F1B10DC119A1A77C06326AC0FB2E2CA83CB611286FDE03077E242185BC4346523DA31F8881808DDD94CB2CE2F7AD7523DE0B50F1BF0DE3F3C634AD3FE7B9398A4564ABCAF86CAFDF0CCDF7A772B97C676397F59AF96AFB4F5447F8C37F7867293BA8B836341848233150C7C120FF5CC5546BE8F094C107E59DA7E618779431DC313C271B47D9D0418DF2AACA8AC14D65BBADC027541F264AEF191EF68B5E223BD17AE7688AAEF001F764E05B9FDA00FA77CF778B5768F4F602EE6636BB0B247F234F56BCD7C44EE740A058F70924B17F2C8327D0002E74357776AA25D11609CB0FE219B395BC3149EFA56906A17A8000F34C554F39468A5F61FE55A7E5E3AAB7104C2947C22156D917072CF82C9ABFD1240F1614FD270219AAAEDAACB9BCDF3E58AA8E6B52CA2BA51E9E1B510ABDE3DD582888065D2A88441E323D90EA5364AE87164CA704CC303CC4FB550129DDB6500B5E81340C88969448541122864FD33865D6A1893461D480D51419879F5F013F8640825D16A61C5467CD7F3FDF9E4D258B846EC73B7DE9EA25BA82A6A515AF72A68A7DDA499693D6ECD832E11D965C6AD5B131166D64016B525358CAB59A4AA8FCE4658ECD137A82EFC3B7567B0AB8B64D4A38E65A1718ADB34886982BC250FA1D4D96B27274CEEDFBA45BCFD4A35DCFA722F5605CDAD56AF64E7AA7E1FDE06B69BC3AF7A86BBE535AE0C246F364204910A5CCC878D20EFA496E8FC2A0BDCB4A3264B991E870CECB2A4C5052B3E891DA83C516EC95E6FCE713C26CE267148A15BE1F1D9FDE882A724AD3231A962CFFFEDC36D07698A01519B5AEC22B01723DEBB0D246170CF887FCA66CA1080521AB5453758A17FBF5DCA11A201EBD32FAA19333912BF7CA4437E322EE52B4BC80A71CF73D38A57A1056F79577B124B11845D55970FD647541720BFE783C3999E064F3B6BE98B1FF965D92DDEF353FB9435EEA9BE65D79BB98EFDE0596C0FEECF206DD338A321EBA6CD49226600C08F16EEECDF30EB29B742E03D70B873A1E8A89BFA1E31494BBD629C885DCE5CAA4BF147EBDAA7166B24C4687366FF583AE674771633AB918AFC0E7377023DF29FF851E448E30BB3DE97DA64C89F9641A5892E174228DE804DC64A6C73F3E17079CB5B6AA99818942CF75A44B54335C4538498177739FBEC3DEA5729C40FE14E4C166AAC4F2BC83F99AD3C2FF239CC3EADDE5B54E0A3E412C70D010130CA3A712B2860A83CF74D27ED98360A4C48AC61E4A3AA9F0A9CE25F5B9984DD033F43FF587253B6770D8438B50E21B32D176D0F6F1188E965C2F11DB034AE722B88B09835BA5E3B94F8BD29005223FFF1E6644616397846A80444A29239AC99576DE8C399A2903A8B388D2C82D2E4AF22C48710985D41335DEC87B8F197CF97BED0CBFAC3D9D23DD71FD0541A2AD5CAAE171FE97CE152C124CC5A4927C5F314BC6851CDA7B40034D958978FB7A63B849768C3D0C1C6AA8DAC6C9FC2A1444F3C949C15AAE63DC1588F2F0757C5ADD6D504EFAA42C2378D52CA6AB15C1488C8C1706D97A2A8B87E1C0B397A161C7BBCB544FB8210A760FB45CF58A54FE16BB26FF2BFB1F4A62A1261221E8FE551D0A135B017625E39134D6DA1829BA5E059C342829A326E128CB3E6CE0047D2E64AACF7CCD219C8049C4D646EBF36537A4009C504E9ED896CD19EBEFB4D39D759F09CBB9522EC6558DF881AD5E90F65A0359BC38D29068F07F516E9C092AE7DAC8B1FDD90E69BD9C05EA589F6E71DF74E43B96D5EC08556A9C5AD7E72C6774D049FA38BB3EFE55A0823D80CBA1C3E00268FBBF05953706CF9E889C0EC9592A71E6AF30C581B1EE91741D94DB682D15ECECF122B6EA7C2EBB0000F50FE4832471EA46CBF2777CE2C076EF2107ED05C79EF9151A2AA48DD86C59D127F3A98F639D5B2A3F09966F44174D3060387613E7EBED6BE69C3CF03439D0E738B68C9DAEEC65BE4312F47AB8E3B309B820A0D7C346760188B9697074787BA8CEDB289647B8F056073C488465549ACA0EAD46007B3608A7C11A303523814AF896ED191A0F16D4CE9F5CBF186A4EB33CC0AC947DE7FA9F9164926E44CD8ABB29B8C191AFFF8FCB925FB42BF820D28DA74A1DBD44CE0AC5715C7FABE3C7F775D95391560BCE928D3C558821249E5D3CB1235B2AA440411DC9BBF527A50F5A84275E19FC884094BB847A5365F4B6846ABB6E6273F2EA5C254DC40A2138A10DEB2628BDFB65A51C4F0FDB0F802BB059B9BC437A993F8D174F95C7AD11672EE82CC2D769D3CF8BA2D173A926E1B6BCDFF95FC26BE2C1D80164786C7E793008627ACC160F5D82928BF2D92B064CFF8541566A4F212F3EF2A2C1E6648DD285798A9C0FDFC7FAF908B823AE750073DCB16B650E2EE5890FA9B48BFB70A79BC62713F37D79C6BB8DA14DACB212A7F0B8622EB18C258ADC5D2DC3E0E80C8690788E3F8A5A43C063FEAB4CD87EDA387D996410189A7A78EEB965C2E81F4CA3AC0CA9F3A21F5DECF8CE76ECD48E0609728585EC924ECAEF66B4DA2BAC6536CD7A5EF40F2655F75B8A60DEF709ECE8C1B10EA34FC48CA9D876CDDEEC3FC4E985E2A25008270822D1E084A33BDB1884414F4FBA3D4D3B41520DAFCA6B95335A8EABF15AD6D22394A0808D6A17DCB173BF538B344255AC8CCB2582B3C7376FF9FF9466007D25BA940F1E4AD058411756413C34BC702325115E256376449EA8DEE35EBEF38AE258AD6BB678DD23DEA59E317C6236987568176D50A25521488C4DED6F546B692078F7894AF0F17B8771FE17DACBD2ECBB8921A1784E6DB7A80C1CFA952CB4672C9565F03B3FEB9E1A1EEE9B4D0C8576C4C19A502B16E87F03B57496CC5B2D85D2F5F479354AD1E8933D2231AF5FDB2743A83C3693611AC452993C41220DA7DA087E71CE436E7A76E3543AE425240D5EB682E3524272E8729B853C7D75DACB66BDE12C64D4386FB1A5E8D9C57F348875D9C84195EC869C1FC75258A758A78E4B6641D12D2B47000B8A6F86A1E59D888095286D67AF88B4E98824E3D66F70414BEBAC8B3747149B572EA7D4C8F0A0AAAF92BE009A67CF8EDDCC050209044333A4AE4EE87164E20709D91A899FC5CD2594E86BC42290DF4CDDAC5C1DB2A7B98A470D11E2400F7870C338DB96041FC10151FA22B5D74375A397B8E049916E08F82FC383860481C2FF50CBCC19BD3428C0E4483C5E7E68C169F1BEDF85356488F6F2F0486FDEB5B74D10579BB5C6E06B7FAB5D888A66B5F1A6D8BF53E6A042385882FB9A6A2131A41697B97FDCB812D8E146AA2C4F0094B94E28308EB77E83714E6675B65BE129CFD47B2E6A122C183693E047E4A93D830E5BC1821722D58E5F22AFF8CF238DDE5B88EC9C5212BA00CCA7707D6718EE68042EFD93DA8B77FAD96D3B59EA116B59A75D511C8926A9B969691EAA1C2F28795D889455B4874253B40DBBD05D6B14323F3BC6530A0F8E6642A156F9F6D4FD9B8853721849ABFB3BD47BF6782280A97FB8A0C2B6A463922CC76500AC10648E5566D3FFC48D339728D08A1DB24B07B3E5DA67444EF8F3AAD5093791A72A5847EF3A82A6CD89322460C59B5E24B1D54EB88868157B2F04AD1CED094865325B322A1B6864F984F9C9307F9574CC07D42D6003967BF5A51037A96B04CC46CBE1B94991A0FE0BDE0AD4768F19F756A64FD5CA704F6808D24FFC8B4BF1F2D28D3BF50FF075885287FD80E698E394760B35507B2C55FD96448762D6DEA24C78F8ED635A89AE027BA716E3CBAA5CB4F9C95A308914140EA9F34255C49033E49904B7C0E3552B11E0C47305ED623826128E686C3809922FB3BF2989D13867EDD78E9D38C2225E1BA26E221593E3A41D70947758821936965524C1D6C119916901258287332C17F96E901E11B16BDB407E78DEFBD142E59C1F7FAECDC6DFB50BAF4D3C897318BD301667C9DD73CACE826B76CC7EAEA968F0C3E1736066BEE6A79EBF10ABC9071D8FC6A5E3C698A3686260AA440008CC04D65B60E9F5B9BBD100ABD575A2A26C557BCC167569259C2D961B6DD8A81945CD09885BB006ED0A1239C85FCB53783618A4B1C7C6964FF0371F841F37E91440E455E0ABB5FF0F69E9E83501F50ECA113D827A159ECFE92DDEDD0959018C28A61EFC49385CF813276ABAACEA4C8EDCE0335CE215DA8BD05AF7607136C316C4B8A7591D856C2DF92D1327BB1FA62C64835C98F6E3C0C95CF8E81B07DFD236E87549387C264F5C1F28C95DD829058FB4C4EA3A1680038AFD9A707C4EAA85602A3E8E293CFEF58144421363F22423317CE4AA55792C1B6008BEE62562F6385A3BE8BA99B4D26D47747F9D1A3E9F6B2841".to_string();
	let piece_hashes = match piece_hashes_string.from_hex() {
		Ok(as_vec) => {
			if (as_vec.len() % 20) != 0 {
				panic!("Piece hashes should be 20 bytes long")
			}

			let mut new_vec: Vec<[u8; 20]> = Vec::new();
			let mut new_bytes = [0; 20];
			let num_pieces = as_vec.len() / 20;
			for p in 0..num_pieces {
				for i in 0..20 {
					new_bytes[i] = as_vec[p + i];
				}
				new_vec.push(new_bytes);
			}

			new_vec
		}
		Err(e) => panic!("Couldn't convert piece hashes")
	};
	let info = Info {
		piece_len: 32768,
		pieces: piece_hashes,
		private: true,
		name: "IMG_3311.JPG12".to_string(),
		length: 13237628
	};
	// MetaInfo end


	let addr = "127.0.0.1:54004";
	let stream = match TcpStream::connect(addr) {
		Ok(s) => s,
		Err(e) => panic!("Couldn't connect to {}, got {}", addr, e)
	};
	let stream_clone = stream.try_clone().unwrap();

	let manager = SocketManager::start::<TcpStream, TcpStream>(stream, stream_clone);

	manager.send(Message::Handshake(
									Protocol::BitTorrent,
									NONE,
									InfoHash::from_str("ca669b6679f03a329f25787c761651a8c36a26a4").ok().unwrap(),
									PeerId::from_str("RT097378612376745896").ok().unwrap()));
	manager.send(Message::Unchoke);
	manager.send(Message::Interested);

	thread::scoped(move || {
		match manager.recv() {
			Ok(message) => {
				match message {
					Message::Handshake(protocol, extensions, info_hash, peer_id) => {
						println!("Handshake({:?}, {:?}, {:?}, {:?}", protocol, extensions, info_hash, peer_id);
					},
					_ => {
						println!("Unexpected message {:?}", message);
						return;
					}
				}
			}
			Err(err) => {
				println!("Error listening for data {:?}", err);
				return;
			}
		}

		for message in manager.recv_iter() {
			println!("{:?}", message);
		}
	});
}
